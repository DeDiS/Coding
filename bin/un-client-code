#!/bin/sh

LANG=C
export LANG

for i in `find . -name \*.go`
do
    echo $i
    
    gofmt -w -r 'onet.NewClientErrorCode(b, err.Error()) -> err' $i
    gofmt -w -r 'onet.NewClientErrorCode(b, c) -> errors.New(c)' $i
    goimports -w $i
    
    perl -p -i \
	 -e 's/cerr = (\w+)\./err = $1./;' \
	 -e 's/cerr := (\w+)\./err := $1./;' \
	 -e 's/cerr onet\.ClientError\) {/err error) {/;' \
	 -e 's/, onet\.ClientError\) {/, error) {/;' \
	 -e 's/\) onet\.ClientError {/) error {/;' \
	 -e 's/	onet\.ClientError\) {/	error) {/;' \
	 -e 's/if cerr != nil/if err != nil/;' \
	 -e 's/if cerr == nil/if err == nil/;' \
	 -e 's/return nil, cerr/return nil, err/;' \
	 -e 's/return nil, onet.NewClientError\(err\)/return nil, err/;' \
	 -e 's/require.Nil\(t, cerr/require.Nil(t, err/;' \
	 -e 's/require.NotNil\(t, cerr\)/require.NotNil(t, err)/;' \
	 -e 's/require.NotNil\(t, cerr,/require.NotNil(t, err,/;' \
	 -e 's/log.ErrFatal\(cerr\)/log.ErrFatal(err)/;' \
	 $i
done

#-e 's/cerr.ErrorCode\(\) == ErrorMergeInProgress/err.Error() == "this skipchain-id is currently processing a block"/;' \
#	 -e 's/cerr.ErrorCode\(\) == service.ErrorWrongPIN/err.Error() == "Wrong PIN"/;' \
